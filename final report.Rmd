---
title: 'Machine Learning: Final Project'
output: html_document
---

#Abstract

This project seeks to demonstrate the effectiveness of machine learning algorithms in R by predicting the class of exercise performed by various participants wearing sensor equipment. To do this, a random forest model was trained to predict exercise class for the training dataset provided for the project. This model achieved ~99.99% accuracy on test runs, and was then used to make predictions based on the test data provided for the project.

#Modeling Process

##Step 1: Setup and Data Processing

This random forest model was built using the caret and e1071 packages in R, which had to be loaded along with the training and test datasets.

```{r}
library(caret)
library(e1071)
training <- read.csv("pml-training.csv")
testing <- read.csv("pml-testing.csv")
```

Before beginning to build the model, the test and training data required cleaning. To do this, the test and training sets were subsetted to include only the columns including data that was physically relevant to the modeling process, and the "classe" column which was used as the response.

```{r}
subTrain_all <- training[,8:160]
testSet <- testing[,8:160]
```

All columns, excluding the "classe" factor variable, were then converted into numeric variables. These columns were then parsed through to find columns which contained NA values. The NA values were concentrated into several specific columns, with no NAs in the other ones. By removing these columns, the model was able to run smoothly. 

```{r}
for(col in 1:(dim(training)[2]-1)){
  training[,col] <- as.numeric(training[,col])
  testing[,col] <- as.numeric(testing[,col])
}
count <- numeric(dim(subTrain_all)[2])
for(col in 1:dim(subTrain_all)[2]){
  count[col] <- length(which(is.na(training[,7+col])))+length(which(is.na(testing[,7+col])))
  count_all <- which(count != 0)
}

subTrain_all <- subTrain_all[,-count_all]
testSet <- testSet[,-count_all]
```

##Step 2: Variable Selection

To improve runtime and reduce the dimensionality of the model, a linear model was used to pick out which variables were significant and which were not. These significant variables were then used to build the final model.

```{r}
fit_all <- glm(classe~.,data=subTrain_all,family="binomial")
inds <- c(which(summary(fit_all)$coef[,dim(summary(fit_all)$coef)[2]]<=0.05),dim(subTrain_all)[2])
subTrain_all <- subTrain_all[,inds]
testSet <- testSet[,inds]
```

##Step 3: Training the Model
Using this properly subsetted data, a final model could be trained using the caret package. Using the train() function, a random forest model was built to predict the "classe" factor variable using the other numeric variables. The initial model runs took over an hour to run each, so in the interest of time the model was set from `ntrees=500` to `ntrees = 5` to reduce runtime. This came at a slight reduction in accuracy; the initial runs had an accuracy of 100% on the training set.

```{r}
fit_all <- train(classe~.,data=subTrain_all,method="rf",ntree=5)
out_all <- predict(fit_all)
```

To estimate out-of-sample error, a function was defined to estimate the error in the training set.

```{r}
err_comp <- function(predicted,expected){
  for(i in 1:length(predicted)){
    flag <- FALSE
    if(predicted[i]==expected[i]){
      flag <- TRUE
    }
    if(!exists("fn_out")){
      fn_out <- c(flag)
    }
    else{
      fn_out[length(fn_out)+1] <- flag
    }
  }
  return(fn_out)
}
```

This function was then used to estimate the percentage of correct and incorrect predictions generated by the model.

```{r}
err_all <- table(err_comp(out_all,subTrain_all[,"classe"]))
print(err_all)
```

According to this, the model produces an accuracy of ~`r {1-round(err_all[1]/err_all[2]*100,2)}`%, or an error of ~`r {round(err_all[1]/err_all[2]*100,2)}`%.

##Step 4: Predicting Test Values

Using the random forest model, predictions could be made for the test dataset. 
```{r}
test_out <- predict(fit_all,testSet)
for(row in 1:length(test_out)){
  print(c(row,as.character(test_out[row])))
}
```


